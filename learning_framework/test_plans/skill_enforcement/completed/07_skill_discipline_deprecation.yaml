# ABOUTME: Test plan for deprecating skill-discipline in favor of hook enforcement
# ABOUTME: Validates whether hooks can fully replace the prompt-based skill discipline

feature:
  name: skill_discipline_deprecation
  description: Can hooks replace the skill-discipline skill entirely?
  category: skill_enforcement

context: |
  The skill-discipline skill attempts to enforce skill usage via prompting:
  "Before responding to ANY user message, complete this checklist..."

  Problem: Prompts can be ignored. Claude rationalizes skipping skills.

  If hook-based enforcement works, skill-discipline becomes redundant.

current_skill_discipline_coverage:
  mandatory_protocol:
    - "List available skills in your mind"
    - "Ask: Does ANY skill match this request?"
    - "If yes â†’ Read the skill file"
    - "Announce which skill you're using"
    - "Follow the skill exactly"
  the_1_percent_rule:
    - "If even 1% chance a skill applies, read it"
  common_rationalizations:
    - "This is just a simple question"
    - "I can check git/files quickly"
    - "Let me gather information first"
    - "This doesn't need a formal skill"
  skills_with_checklists:
    - "Create TodoWrite todos for each checklist item"
  announcing_skill_usage:
    - "Say: 'I'm using [Skill Name] to [what]'"

# Mapping skill-discipline coverage to hooks
hook_coverage_mapping:
  - discipline_aspect: "Check if skill applies"
    hook_approach: "UserPromptSubmit analyzes prompt for skill triggers"
    coverage: "Partial - keyword-based, not exhaustive"

  - discipline_aspect: "Read the skill file"
    hook_approach: "Hook can remind but can't force"
    coverage: "Partial - reminder only"

  - discipline_aspect: "Announce skill usage"
    hook_approach: "Can't enforce announcements"
    coverage: "Not covered"

  - discipline_aspect: "TodoWrite for checklists"
    hook_approach: "Could detect skill invocation, remind about TodoWrite"
    coverage: "Possible"

  - discipline_aspect: "Prevent rationalizations"
    hook_approach: "Enforcement makes rationalization harder"
    coverage: "Main benefit of hooks"

hypotheses:
  - id: h1
    statement: "Hooks cover the main failure modes of skill-discipline"
    failure_modes:
      - "Forgetting to check for applicable skills"
      - "Rationalizing that skill doesn't apply"
      - "Skipping skill because 'too simple'"
    hook_mitigation:
      - "Automatic detection, no need to remember"
      - "Hard to rationalize when hook explicitly reminds"
      - "Blocking mode prevents skipping"
    evidence_needed:
      - "Compare skill compliance: discipline vs hooks"

  - id: h2
    statement: "Some discipline aspects can't be replaced by hooks"
    unreplaceable:
      - "Announcing skill usage (social/documentation)"
      - "TodoWrite checklist creation (internal process)"
      - "Following skill exactly (semantic understanding)"
    evidence_needed:
      - "Document what's lost without skill-discipline"
      - "Assess if loss is acceptable"

  - id: h3
    statement: "Hybrid approach is optimal"
    approach: |
      - Hooks: Automated enforcement for detectable patterns
      - SessionStart reminder: Lightweight reminder for non-detectable cases
      - skill-discipline: Deprecated, guidance folded into CLAUDE.md
    evidence_needed:
      - "Compare: hooks-only vs hybrid vs current"

experiments:
  - id: coverage_gap_analysis
    hypothesis_id: h2
    description: Identify what hooks CAN'T cover
    methodology: |
      Review each section of skill-discipline skill.
      For each requirement, assess:
      1. Can a hook detect the trigger?
      2. Can a hook enforce the behavior?
      3. What's lost without this requirement?
    document:
      - "Gap analysis table"
      - "Acceptable vs unacceptable gaps"

  - id: discipline_vs_hooks_compliance
    hypothesis_id: h1
    description: Compare skill compliance between approaches
    phases:
      baseline: |
        1 week with current skill-discipline (prompt-based)
        Track: Skills used, skills skipped, rationalization frequency
      hooks_only: |
        1 week with hooks, skill-discipline disabled
        Track: Same metrics
      hybrid: |
        1 week with hooks + minimal SessionStart reminder
        Track: Same metrics
    compare:
      - "Compliance rate per approach"
      - "False positive rate"
      - "User satisfaction"

  - id: announcement_value
    hypothesis_id: h2
    description: Is skill announcement valuable?
    question: |
      skill-discipline requires: "Say: 'I'm using [Skill Name]'"
      Is this valuable? Can we lose it?
    analysis:
      value_arguments:
        - "Transparency - user knows what's happening"
        - "Self-discipline - saying it reinforces commitment"
        - "Debugging - can trace back to skill used"
      cost_arguments:
        - "Verbosity - extra text in responses"
        - "Enforcement - hooks can't make me announce"
      conclusion: "TBD based on experiment"

  - id: todowrite_checklist_enforcement
    hypothesis_id: h2
    description: Can hooks enforce TodoWrite for skill checklists?
    approach: |
      PostToolUse hook on Skill tool:
      1. Detect which skill was invoked
      2. Check if skill has a checklist
      3. Verify TodoWrite was called with checklist items
    implementation_sketch: |
      #!/usr/bin/env python3
      import json
      import sys

      data = json.load(sys.stdin)
      tool_name = data.get('tool_name', '')
      skill_name = data.get('tool_input', {}).get('skill', '')

      # Skills with checklists
      skills_with_checklists = {
          'test-driven-development': ['Write failing test', 'Verify fail', ...],
          'verification-before-completion': ['Run verification', 'Read output', ...],
      }

      if skill_name in skills_with_checklists:
          print(f"ðŸ“‹ CHECKLIST REMINDER: {skill_name} has a checklist")
          print("   Create TodoWrite items for each step.")
    feasibility: "Medium - requires PostToolUse on Skill, need to verify this works"

  - id: minimal_sessionstart_reminder
    hypothesis_id: h3
    description: Design minimal replacement for skill-discipline reminder
    current_reminder: |
      ðŸ“š **Skill Discipline Reminder**
      Before responding, check: Does a skill apply to this task?
      Key skills available: [list]
      **Rule:** If a skill applies, announce it and follow it exactly.
      **Memory:** For complex work, search your journal first.
    proposed_minimal: |
      ðŸ“š Skills are enforced via hooks. For non-detectable cases:
      - Journal search for complex work
      - Announce skill usage for transparency
    comparison:
      - "Word count reduction"
      - "Retained vs removed guidance"

migration_plan:
  phase_1_parallel: |
    Run hooks alongside skill-discipline for 2 weeks.
    Verify hooks catch what discipline catches.

  phase_2_reduce: |
    Reduce skill-discipline to minimal reminder.
    Move enforcement guidance to CLAUDE.md.

  phase_3_deprecate: |
    After successful validation:
    1. Move skill-discipline to .claude/skills/_deprecated/
    2. Update CLAUDE.md with hook-based enforcement
    3. Update session-start-skill-reminder.py to minimal version

  rollback_criteria: |
    Rollback to skill-discipline if:
    - Compliance drops > 30%
    - False positive rate > 25%
    - Hooks cause unacceptable latency
    - Gaps prove unacceptable

success_metrics:
  - "Skill compliance maintained or improved"
  - "Coverage gaps documented and acceptable"
  - "Migration plan validated"
  - "skill-discipline successfully deprecated"

notes: |
  skill-discipline is meta - it's about using other skills.
  It's the most abstract and hardest to enforce via hooks.

  Key insight: Most of skill-discipline's value is in preventing
  rationalization. If hooks make it hard to skip skills without
  acknowledgment, the main value is preserved.

  What we lose:
  - Comprehensive mental checklist (replaced by targeted hooks)
  - Skill announcement requirement (optional, can keep via convention)
  - TodoWrite checklist enforcement (possible with PostToolUse hook)

  What we gain:
  - Harder to ignore (hooks vs prompts)
  - Targeted reminders (not generic list)
  - Audit trail (hook logs)
