# ABOUTME: Test plan for understanding custom tools and MCP servers
# ABOUTME: Based on original vision - "How do I make custom tools? What are good use cases?"

feature:
  name: custom_tools_mcp
  description: Understanding custom tools vs MCP servers - creation, use cases, gotchas
  category: claude-code

# From original vision (docs/prompt):
# "How do I make custom tools? What are good use cases for them? Anything not obvious about getting them to work?"
original_questions:
  - How do I make custom tools?
  - What are good use cases for them?
  - Anything not obvious about getting them to work?
  - When should I use custom tools vs MCP servers?

learning_goals:
  - Understand how to create custom tools
  - Learn the difference between custom tools and MCP servers
  - Identify appropriate use cases for each
  - Document gotchas and non-obvious behaviors
  - Understand permission implications

hypotheses:
  - id: h1
    statement: "Custom tools are defined in mcp.json and exposed to Claude"
    evidence_needed:
      - Tool appears in available tools list
      - Claude can invoke the tool
      - Tool receives expected input format

  - id: h2
    statement: "MCP servers provide tools that Claude can discover and use"
    evidence_needed:
      - Server starts successfully
      - Tools are listed in init message
      - Tools execute correctly

  - id: h3
    statement: "Custom tools are better for simple, project-specific operations"
    evidence_needed:
      - Comparison of complexity to implement
      - Performance comparison
      - Maintenance considerations

  - id: h4
    statement: "MCP servers are better for complex, reusable integrations"
    evidence_needed:
      - Examples of complex integrations
      - Reuse across projects
      - State management capabilities

  - id: h5
    statement: "Tool permissions in settings.json affect custom tool access"
    evidence_needed:
      - Test with restricted permissions
      - Test with permissive permissions
      - Document exact permission patterns needed

experiments:
  - id: create_simple_custom_tool
    hypothesis_id: h1
    description: Create a minimal custom tool and verify it works
    setup:
      mcp_config:
        mcpServers:
          simple-tool:
            command: "python"
            args: ["tools/simple_tool.py"]
      tool_script: |
        # A simple tool that echoes input
        import sys
        import json
        input_data = json.loads(sys.stdin.read())
        result = {"echoed": input_data.get("message", "no message")}
        print(json.dumps(result))
    test_prompts:
      - "Use the simple-tool to echo 'hello world'"
    expected:
      - Tool appears in available tools
      - Claude successfully invokes it
      - Correct result returned

  - id: mcp_server_setup
    hypothesis_id: h2
    description: Set up a basic MCP server and test tool discovery
    setup:
      mcp_config: |
        {
          "mcpServers": {
            "test-mcp": {
              "command": "python",
              "args": ["-m", "test_mcp_server"]
            }
          }
        }
    test_prompts:
      - "What tools are available from test-mcp?"
      - "Use the test-mcp tool to do something"
    observe:
      - Tool discovery in init message
      - Tool invocation success
      - Error handling

  - id: compare_complexity
    hypothesis_id: h3
    description: Compare implementing same functionality as tool vs MCP server
    implementation_target: "File search with pattern matching"
    compare:
      custom_tool:
        - Lines of code
        - Setup complexity
        - Maintenance burden
      mcp_server:
        - Lines of code
        - Setup complexity
        - Reusability

  - id: permission_testing
    hypothesis_id: h5
    description: Test how settings.json permissions affect custom tools
    test_cases:
      - description: No permissions for custom tool
        settings: '{"allowed_tools": []}'
        expected: Tool blocked or not visible

      - description: Wildcard permission
        settings: '{"allowed_tools": ["*"]}'
        expected: Tool accessible

      - description: Specific tool permission
        settings: '{"allowed_tools": ["mcp__test-tool__*"]}'
        expected: Only that tool accessible

success_metrics:
  - "Can create and use a custom tool from scratch"
  - "Understand MCP server setup process"
  - "Clear guidance on when to use custom tools vs MCP"
  - "Documented permission patterns for tools"
  - "Known gotchas and workarounds"

testing_process:
  1_setup: |
    Create test tools in tester_workspace/tools/
    Create mcp.json configuration
    Set up permissions in settings.json

  2_test: |
    python run_experiment.py "Use the custom tool to..."

    Observe:
    - Is tool visible in init message?
    - Does invocation work?
    - What errors occur?

  3_record: |
    python record_experiment.py \
      --feature custom_tools_mcp \
      --hypothesis "..." \
      --prompt "..." \
      --expected ... \
      --actual ... \
      --notes "Tool visible: yes/no, Invocation: success/fail, Errors: [list]"

notes: |
  Key questions from original vision still unanswered:
  1. What's the mcp.json format exactly?
  2. How does tool input/output work?
  3. What permissions are needed in settings.json?
  4. How do you debug tool failures?
  5. Are there performance implications?
